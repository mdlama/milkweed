---
title: "Bootstrap"
author: "Soren Struckman"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: html_document
---

# Initialization

```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(milkweed)
library(dplyr)
library(ggplot2)
requirePackages(c("doParallel", "latex2exp"))
library(doParallel) # Normally, I don't load suggested packages, but this one requires and loads parallel, foreach, and iterators,
                    #   so, you know, it's easier this way.
'%<>%' <- magrittr::'%<>%'
TeX <- latex2exp::TeX
#mwCache <- '../../data/mwCache'
```

# Analysis

## Bootstrap

The results object should have everything we need to generate the caterpillar plot and confidence intervals around elasticities, as well as a confidence interval around lambda.
```{r}
compute <- FALSE

ipm = mwIPM(list(compute = TRUE, saveresults = FALSE))

if (!file.exists(file.path(mwCache,"figure6.RData")) | (compute)) {
  numcl <- detectCores()-1
  registerDoParallel(cores = numcl)
  results <- tbl_df(foreach(i=1:4, .combine=bind_rows) %dopar% { #3 was previously 20
    library(milkweed)
    library(dplyr)
    '%<>%' <- magrittr::'%<>%'
    ipm %<>% bootIPM() %>% analyzeParameters(distpars = FALSE) #changed from TRUE
    thisone <- ipm$analysis$parameters
    thisone
  })
  
  save(results, file=file.path(mwCache,"figure6.RData"))
} else {
  load(file.path(mwCache,"figure6.RData"))
}
```
