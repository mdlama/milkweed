---
title: "Fit Cardenolide Distribution"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  html_document:
    toc: true
---

We use the `fdistrplus` package (https://cran.r-project.org/web/packages/fitdistrplus/vignettes/paper2JSS.pdf)

```{r, warning=FALSE, message=FALSE}
library(milkweed)
library(fitdistrplus)
library(dplyr)
library(magrittr)
sites <- c("Bertha", "BLD", "PWR", "SKY", "YTB")
```

Read, filter and transform data.
```{r}
metadata <- full.data

Cardenolides <- metadata %>% 
  filter(!is.na(Cardenolides)) %$%
  Cardenolides
```

# Bertha

Fits of cardenolide concentrations.
```{r, message=FALSE, warning=FALSE}
distnames <- c("norm", "lnorm", "gamma", "exp", "weibull")

f0 <- fitdist(Cardenolides, distnames[1])
f1 <- fitdist(Cardenolides, distnames[2])
f2 <- fitdist(Cardenolides, distnames[3])
f3 <- fitdist(Cardenolides, distnames[4])
f4 <- fitdist(Cardenolides, distnames[5])
```

Plot results.
```{r}
plot_diagnostics <- function(...) {
  par(mfrow=c(2,2))
  denscomp(list(...), legendtext = distnames)
  cdfcomp(list(...), legendtext = distnames)
  qqcomp(list(...), legendtext = distnames)
  ppcomp(list(...), legendtext = distnames)
  par(mfrow=c(1,1))
}

plot_diagnostics(f0, f1, f2, f3, f4)
```

Goodness-of-fit measures.
```{r}
gofstat(list(f0, f1, f2, f3, f4), fitnames = distnames)
```

Weibull looks the best when looking at AIC, but normal is close enough for our purposes and it makes for easier interpretation and implementation of parameter perturbation for elasticity analysis.

# Sites

```{r}
fit_site <- function(mysite) {
  cat(mysite)
  Cardenolides <- metadata %>% 
    filter(!is.na(Cardenolides),
           site == mysite)  %$%
    Cardenolides

  f0 <- fitdist(Cardenolides, distnames[1])
  f1 <- fitdist(Cardenolides, distnames[2])
  f2 <- fitdist(Cardenolides, distnames[3])
  f3 <- fitdist(Cardenolides, distnames[4])
  f4 <- fitdist(Cardenolides, distnames[5])
  
  cat("\n-------\n")
  print(gofstat(list(f0, f1, f2, f3, f4), fitnames = distnames))
  ind <- which.min(gofstat(list(f0, f1, f2, f3, f4))$bic)
  
  cat("Diagnostic plots:\n")
  plot_diagnostics(f0, f1, f2, f3, f4)
}
```

## BLD

```{r, warning=FALSE}
fit_site("BLD")
```

Results suggest going with a Weibull distribution.



## PWR

```{r, warning=FALSE}
fit_site("PWR")
```

Results suggest going with a Weibull distribution.

## SKY

```{r, warning=FALSE}
fit_site("SKY")
```

Results suggest Weibull or normal.

## YTB

```{r, warning=FALSE}
fit_site("YTB")
```

Results suggest going with a gamma, Weibull or log-normal distribution.
